function FindProxyForURL(url, host) {
    var IP = "91.106.109.12";
    var JITTER_WINDOW = 3;
    var STICKY_SALT = "JO_STICKY";

    var GAME_DOMAINS = [
        "*.proximabeta.com",
        "*.igamecj.com",
        "*.tencentgames.com",
        "*.tencent.com",
        "*.pubgmobile.com",
        "*.pubgmobile.net",
        "*.gcloud.qq.com",
        "*.cdn.pubgmobile.com"
    ];

    var GAME_PORTS = [
        20001,
        20002,
        20000,
        17500,
        17000
    ];

    var LOBBY_PORTS = [
        8085, 8086, 8087, 8088, 8089, 8090,
        10010, 10012, 10013, 10039, 10096,
        10491, 10612, 11000, 11455, 12235,
        13748, 13894, 13972, 14000, 8011, 9030
    ];

    var JO_RANGES = [
        ["37.17.192.0","255.255.240.0"],   // /20
        ["46.185.128.0","255.255.128.0"],  // /17
        ["109.107.224.0","255.255.224.0"], // /19
        ["176.29.0.0","255.255.0.0"],      // /16
        ["212.35.0.0","255.255.0.0"],      // /16
["2.17.24.0","255.255.255.0"],
    ["2.17.25.0","255.255.255.0"],
    ["2.17.26.0","255.255.255.0"],
    ["2.17.27.0","255.255.255.0"],
    ["37.202.64.0","255.255.255.0"],
    ["37.202.65.0","255.255.255.0"],
    ["37.202.66.0","255.255.255.0"],
    ["37.202.67.0","255.255.255.0"],
    ["37.202.68.0","255.255.255.0"],
    ["37.202.69.0","255.255.255.0"],
    ["37.202.70.0","255.255.255.0"],
    ["37.202.71.0","255.255.255.0"],
    ["37.202.72.0","255.255.255.0"],
    ["37.202.73.0","255.255.255.0"],
    ["37.202.74.0","255.255.255.0"],
    ["37.202.75.0","255.255.255.0"],
    ["37.202.76.0","255.255.255.0"],
    ["37.202.77.0","255.255.255.0"],
    ["37.202.78.0","255.255.255.0"],
    ["37.202.79.0","255.255.255.0"],
    ["37.202.80.0","255.255.255.0"],
    ["37.202.81.0","255.255.255.0"],
    ["37.202.82.0","255.255.255.0"],
    ["37.202.83.0","255.255.255.0"],
    ["37.202.84.0","255.255.255.0"],
    ["37.202.85.0","255.255.255.0"],
    ["37.202.86.0","255.255.255.0"],
    ["37.202.87.0","255.255.255.0"],
    ["37.202.88.0","255.255.255.0"],
    ["37.202.89.0","255.255.255.0"],
    ["37.202.90.0","255.255.255.0"],
    ["37.202.91.0","255.255.255.0"],
    ["37.202.92.0","255.255.255.0"],
    ["37.202.93.0","255.255.255.0"],
    ["37.202.94.0","255.255.255.0"],
    ["37.202.95.0","255.255.255.0"],
    ["37.220.112.0","255.255.255.0"],
    ["37.220.113.0","255.255.255.0"],
    ["37.220.114.0","255.255.255.0"],
    ["37.220.115.0","255.255.255.0"],
    ["37.220.116.0","255.255.255.0"],
    ["37.220.117.0","255.255.255.0"],
    ["37.220.118.0","255.255.255.0"],
    ["37.220.119.0","255.255.255.0"],
    ["37.220.120.0","255.255.255.0"],
    ["37.220.121.0","255.255.255.0"],
    ["37.220.122.0","255.255.255.0"],
    ["37.220.123.0","255.255.255.0"],
    ["37.220.124.0","255.255.255.0"],
    ["37.220.125.0","255.255.255.0"],
    ["37.220.126.0","255.255.255.0"],
    ["37.220.127.0","255.255.255.0"],
    ["46.32.96.0","255.255.255.0"],
    ["46.32.97.0","255.255.255.0"],
    ["46.32.98.0","255.255.255.0"],
    ["46.32.99.0","255.255.255.0"],
    ["46.32.100.0","255.255.255.0"],
    ["46.32.101.0","255.255.255.0"],
    ["46.32.102.0","255.255.255.0"],
    ["46.32.103.0","255.255.255.0"],
    ["46.32.104.0","255.255.255.0"],
    ["46.32.105.0","255.255.255.0"],
    ["46.32.106.0","255.255.255.0"],
    ["62.72.160.0","255.255.255.0"],
    ["62.72.161.0","255.255.255.0"],
    ["62.72.162.0","255.255.255.0"],
    ["62.72.163.0","255.255.255.0"],
    ["62.72.164.0","255.255.255.0"],
    ["62.72.165.0","255.255.255.0"],
    ["62.72.166.0","255.255.255.0"],
    ["62.72.167.0","255.255.255.0"],
    ["62.72.168.0","255.255.255.0"],
    ["62.72.169.0","255.255.255.0"],
    ["62.72.170.0","255.255.255.0"],
    ["62.72.171.0","255.255.255.0"],
    ["62.72.172.0","255.255.255.0"],
    ["62.72.173.0","255.255.255.0"],
    ["62.72.174.0","255.255.255.0"],
    ["62.72.175.0","255.255.255.0"],
    ["79.173.192.0","255.255.255.0"],
    ["79.173.193.0","255.255.255.0"],
    ["79.173.194.0","255.255.255.0"],
    ["79.173.195.0","255.255.255.0"],
    ["79.173.196.0","255.255.255.0"],
    ["79.173.197.0","255.255.255.0"],
    ["79.173.198.0","255.255.255.0"],
    ["79.173.199.0","255.255.255.0"],
    ["79.173.200.0","255.255.255.0"],
    ["79.173.201.0","255.255.255.0"],
    ["79.173.202.0","255.255.255.0"],
    ["79.173.203.0","255.255.255.0"],
    ["79.173.204.0","255.255.255.0"],
    ["79.173.205.0","255.255.255.0"],
    ["79.173.206.0","255.255.255.0"],
    ["79.173.207.0","255.255.255.0"],
    ["84.18.32.0","255.255.255.0"],
    ["84.18.33.0","255.255.255.0"],
    ["84.18.34.0","255.255.255.0"],
    ["84.18.35.0","255.255.255.0"],
    ["84.18.36.0","255.255.255.0"],
    ["84.18.37.0","255.255.255.0"],
    ["84.18.38.0","255.255.255.0"],
    ["84.18.39.0","255.255.255.0"],
    ["84.18.40.0","255.255.255.0"],
    ["84.18.41.0","255.255.255.0"],
    ["84.18.42.0","255.255.255.0"],
    ["84.18.43.0","255.255.255.0"],
    ["84.18.44.0","255.255.255.0"],
    ["84.18.45.0","255.255.255.0"],
    ["84.18.46.0","255.255.255.0"],
    ["84.18.47.0","255.255.255.0"],
    ["86.108.0.0","255.255.255.0"],
    ["86.108.1.0","255.255.255.0"],
    ["86.108.2.0","255.255.255.0"],
    ["86.108.3.0","255.255.255.0"],
    ["86.108.4.0","255.255.255.0"],
    ["86.108.5.0","255.255.255.0"],
    ["86.108.6.0","255.255.255.0"],
    ["86.108.7.0","255.255.255.0"],
    ["86.108.8.0","255.255.255.0"],
    ["86.108.9.0","255.255.255.0"],
    ["86.108.10.0","255.255.255.0"],
    ["86.108.11.0","255.255.255.0"],
    ["86.108.12.0","255.255.255.0"],
    ["86.108.13.0","255.255.255.0"],
    ["86.108.14.0","255.255.255.0"],
    ["86.108.15.0","255.255.255.0"],
    ["91.106.96.0","255.255.255.0"],
    ["91.106.97.0","255.255.255.0"],
    ["91.106.98.0","255.255.255.0"],
    ["91.106.99.0","255.255.255.0"],
    ["91.106.100.0","255.255.255.0"],
    ["91.106.101.0","255.255.255.0"],
    ["91.106.102.0","255.255.255.0"],
    ["91.106.103.0","255.255.255.0"],
    ["91.106.104.0","255.255.255.0"],
    ["91.106.105.0","255.255.255.0"],
    ["91.106.106.0","255.255.255.0"],
    ["91.106.107.0","255.255.255.0"],
    ["91.106.108.0","255.255.255.0"],
    ["91.106.109.0","255.255.255.0"],
    ["91.106.110.0","255.255.255.0"],
    ["91.106.111.0","255.255.255.0"],
    ["91.186.224.0","255.255.255.0"],
    ["91.186.225.0","255.255.255.0"],
    ["91.186.226.0","255.255.255.0"],
    ["91.186.227.0","255.255.255.0"],
    ["91.186.228.0","255.255.255.0"],
    ["91.186.229.0","255.255.255.0"],
    ["91.186.230.0","255.255.255.0"],
    ["91.186.231.0","255.255.255.0"],
    ["91.186.232.0","255.255.255.0"],
    ["91.186.233.0","255.255.255.0"],
    ["91.186.234.0","255.255.255.0"],
    ["91.186.235.0","255.255.255.0"],
    ["91.186.236.0","255.255.255.0"],
    ["91.186.237.0","255.255.255.0"],
    ["91.186.238.0","255.255.255.0"],
    ["91.186.239.0","255.255.255.0"],
    ["109.107.224.0","255.255.255.0"],
    ["109.107.225.0","255.255.255.0"],
    ["109.107.226.0","255.255.255.0"],
    ["109.107.227.0","255.255.255.0"],
    ["109.107.228.0","255.255.255.0"],
    ["109.107.229.0","255.255.255.0"],
    ["109.107.230.0","255.255.255.0"],
    ["109.107.231.0","255.255.255.0"],
    ["109.107.232.0","255.255.255.0"],
    ["109.107.233.0","255.255.255.0"],
    ["109.107.234.0","255.255.255.0"],
    ["109.107.235.0","255.255.255.0"],
    ["109.107.236.0","255.255.255.0"],
    ["109.107.237.0","255.255.255.0"],
    ["109.107.238.0","255.255.255.0"],
    ["109.107.239.0","255.255.255.0"],
    ["109.237.192.0","255.255.255.0"],
    ["109.237.193.0","255.255.255.0"],
    ["109.237.194.0","255.255.255.0"],
    ["109.237.195.0","255.255.255.0"],
    ["109.237.196.0","255.255.255.0"],
    ["109.237.197.0","255.255.255.0"],
    ["109.237.198.0","255.255.255.0"],
    ["109.237.199.0","255.255.255.0"],
    ["109.237.200.0","255.255.255.0"],
    ["109.237.201.0","255.255.255.0"],
    ["109.237.202.0","255.255.255.0"],
    ["109.237.203.0","255.255.255.0"],
    ["109.237.204.0","255.255.255.0"],
    ["109.237.205.0","255.255.255.0"],
    ["109.237.206.0","255.255.255.0"],
    ["109.237.207.0","255.255.255.0"]
    ];

    function isGameHost(h) {
        for (var i = 0; i < GAME_DOMAINS.length; i++) {
            if (shExpMatch(h, GAME_DOMAINS[i])) return true;
        }
        return false;
    }

    function isInJoRanges(h) {
        try {
            for (var i = 0; i < JO_RANGES.length; i++) {
                if (isInNet(h, JO_RANGES[i][0], JO_RANGES[i][1])) return true;
            }
        } catch (e) {}
        try {
            var resolved = dnsResolve(h);
            if (resolved) {
                for (var j = 0; j < JO_RANGES.length; j++) {
                    if (isInNet(resolved, JO_RANGES[j][0], JO_RANGES[j][1])) return true;
                }
            }
        } catch (e) {}
        return false;
    }

    function djb2(s) {
        var h = 5381;
        for (var i = 0; i < s.length; i++) {
            h = ((h << 5) + h) + s.charCodeAt(i);
            h = h & 0x7fffffff;
        }
        return h;
    }

    var ports;
    if (isGameHost(host)) {
        ports = GAME_PORTS.concat(LOBBY_PORTS);
    } else if (isInJoRanges(host)) {
        ports = GAME_PORTS.concat(LOBBY_PORTS); // Jordan CIDR => favor game ports first
    } else {
        ports = LOBBY_PORTS.concat(GAME_PORTS);
    }

    var clientIP = myIpAddress();
    var baseHash = djb2(host + "|" + clientIP + "|" + STICKY_SALT);
    var stickyIndex = Math.abs(baseHash) % ports.length;

    var minuteBucket = Math.floor(new Date().getTime() / 60000);
    var jitterSpan = (JITTER_WINDOW * 2) + 1;
    var jitter = (djb2(host + "|" + minuteBucket) % jitterSpan) - JITTER_WINDOW;

    var startIndex = (stickyIndex + jitter) % ports.length;
    if (startIndex < 0) startIndex += ports.length;

    var ordered = [];
    for (var k = 0; k < ports.length; k++) {
        var idx = (startIndex + k) % ports.length;
        ordered.push("PROXY " + IP + ":" + ports[idx]);
    }

    return ordered.join(";");
}
