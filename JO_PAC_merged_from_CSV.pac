function FindProxyForURL(url, host) {
  var FORBID_DIRECT_GLOBAL = false;
  var PROXIES = [
    { ip: "91.106.109.12", ports: [20001,443,8080], weight: 5 },
    { ip: "176.28.250.122", ports: [8080,443],       weight: 3 },
    { ip: "79.173.251.142", ports: [8000,443],       weight: 2 }
  ];
  var JO_IP_SUBNETS = [
    ["109.237.192.0","255.255.255.0"],
    ["109.237.193.0","255.255.255.0"],
    ["109.237.194.0","255.255.255.0"],
    ["109.237.195.0","255.255.255.0"],
    ["109.237.196.0","255.255.255.0"],
    ["109.237.197.0","255.255.255.0"],
    ["109.237.198.0","255.255.255.0"],
    ["109.237.199.0","255.255.255.0"],
    ["109.237.200.0","255.255.255.0"],
    ["109.237.201.0","255.255.255.0"],
    ["109.237.202.0","255.255.255.0"],
    ["109.237.203.0","255.255.255.0"],
    ["109.237.204.0","255.255.255.0"],
    ["109.237.205.0","255.255.255.0"],
    ["109.237.206.0","255.255.255.0"],
    ["109.237.207.0","255.255.255.0"],
    ["176.28.128.0","255.255.255.0"],
    ["176.28.129.0","255.255.255.0"],
    ["176.28.130.0","255.255.255.0"],
    ["176.28.131.0","255.255.255.0"],
    ["176.28.132.0","255.255.255.0"],
    ["176.28.133.0","255.255.255.0"],
    ["176.28.134.0","255.255.255.0"],
    ["176.28.135.0","255.255.255.0"],
    ["176.28.136.0","255.255.255.0"],
    ["176.28.137.0","255.255.255.0"],
    ["176.28.138.0","255.255.255.0"],
    ["176.28.139.0","255.255.255.0"],
    ["176.28.140.0","255.255.255.0"],
    ["176.28.141.0","255.255.255.0"],
    ["176.28.142.0","255.255.255.0"],
    ["176.28.143.0","255.255.255.0"],
    ["176.28.144.0","255.255.255.0"],
    ["176.28.145.0","255.255.255.0"],
    ["176.28.146.0","255.255.255.0"],
    ["176.28.147.0","255.255.255.0"],
    ["176.28.148.0","255.255.255.0"],
    ["176.28.149.0","255.255.255.0"],
    ["176.28.150.0","255.255.255.0"],
    ["176.28.151.0","255.255.255.0"],
    ["176.28.152.0","255.255.255.0"],
    ["176.28.153.0","255.255.255.0"],
    ["176.28.154.0","255.255.255.0"],
    ["176.28.155.0","255.255.255.0"],
    ["176.28.156.0","255.255.255.0"],
    ["176.28.157.0","255.255.255.0"],
    ["176.28.158.0","255.255.255.0"],
    ["176.28.159.0","255.255.255.0"],
    ["176.28.160.0","255.255.255.0"],
    ["176.28.161.0","255.255.255.0"],
    ["176.28.162.0","255.255.255.0"],
    ["176.28.163.0","255.255.255.0"],
    ["176.28.164.0","255.255.255.0"],
    ["176.28.165.0","255.255.255.0"],
    ["176.28.166.0","255.255.255.0"],
    ["176.28.167.0","255.255.255.0"],
    ["176.28.168.0","255.255.255.0"],
    ["176.28.169.0","255.255.255.0"],
    ["176.28.170.0","255.255.255.0"],
    ["176.28.171.0","255.255.255.0"],
    ["176.28.172.0","255.255.255.0"],
    ["176.28.173.0","255.255.255.0"],
    ["176.28.174.0","255.255.255.0"],
    ["176.28.175.0","255.255.255.0"],
    ["176.28.176.0","255.255.255.0"],
    ["176.28.177.0","255.255.255.0"],
    ["176.28.178.0","255.255.255.0"],
    ["176.28.179.0","255.255.255.0"],
    ["176.28.180.0","255.255.255.0"],
    ["176.28.181.0","255.255.255.0"],
    ["176.28.182.0","255.255.255.0"],
    ["176.28.183.0","255.255.255.0"],
    ["176.28.184.0","255.255.255.0"],
    ["176.28.185.0","255.255.255.0"],
    ["176.28.186.0","255.255.255.0"],
    ["176.28.187.0","255.255.255.0"],
    ["176.28.188.0","255.255.255.0"],
    ["176.28.189.0","255.255.255.0"],
    ["176.28.190.0","255.255.255.0"],
    ["176.28.191.0","255.255.255.0"],
    ["176.28.192.0","255.255.255.0"],
    ["176.28.193.0","255.255.255.0"],
    ["176.28.194.0","255.255.255.0"],
    ["176.28.195.0","255.255.255.0"],
    ["176.28.196.0","255.255.255.0"],
    ["176.28.197.0","255.255.255.0"],
    ["176.28.198.0","255.255.255.0"],
    ["176.28.199.0","255.255.255.0"],
    ["176.28.200.0","255.255.255.0"],
    ["176.28.201.0","255.255.255.0"],
    ["176.28.202.0","255.255.255.0"],
    ["176.28.203.0","255.255.255.0"],
    ["176.28.204.0","255.255.255.0"],
    ["176.28.205.0","255.255.255.0"],
    ["176.28.206.0","255.255.255.0"],
    ["176.28.207.0","255.255.255.0"],
    ["176.28.208.0","255.255.255.0"],
    ["176.28.209.0","255.255.255.0"],
    ["176.28.210.0","255.255.255.0"],
    ["176.28.211.0","255.255.255.0"],
    ["176.28.212.0","255.255.255.0"],
    ["176.28.213.0","255.255.255.0"],
    ["176.28.214.0","255.255.255.0"],
    ["176.28.215.0","255.255.255.0"],
    ["176.28.216.0","255.255.255.0"],
    ["176.28.217.0","255.255.255.0"],
    ["176.28.218.0","255.255.255.0"],
    ["176.28.219.0","255.255.255.0"],
    ["176.28.220.0","255.255.255.0"],
    ["176.28.221.0","255.255.255.0"],
    ["176.28.222.0","255.255.255.0"],
    ["176.28.223.0","255.255.255.0"],
    ["176.28.224.0","255.255.255.0"],
    ["176.28.225.0","255.255.255.0"],
    ["176.28.226.0","255.255.255.0"],
    ["176.28.227.0","255.255.255.0"],
    ["176.28.228.0","255.255.255.0"],
    ["176.28.229.0","255.255.255.0"],
    ["176.28.230.0","255.255.255.0"],
    ["176.28.231.0","255.255.255.0"],
    ["176.28.232.0","255.255.255.0"],
    ["176.28.233.0","255.255.255.0"],
    ["176.28.234.0","255.255.255.0"],
    ["176.28.235.0","255.255.255.0"],
    ["176.28.236.0","255.255.255.0"],
    ["176.28.237.0","255.255.255.0"],
    ["176.28.238.0","255.255.255.0"],
    ["176.28.239.0","255.255.255.0"],
    ["176.28.240.0","255.255.255.0"],
    ["176.28.241.0","255.255.255.0"],
    ["176.28.242.0","255.255.255.0"],
    ["176.28.243.0","255.255.255.0"],
    ["176.28.244.0","255.255.255.0"],
    ["176.28.245.0","255.255.255.0"],
    ["176.28.246.0","255.255.255.0"],
    ["176.28.247.0","255.255.255.0"],
    ["176.28.248.0","255.255.255.0"],
    ["176.28.249.0","255.255.255.0"],
    ["176.28.250.0","255.255.255.0"],
    ["176.28.251.0","255.255.255.0"],
    ["176.28.252.0","255.255.255.0"],
    ["176.28.253.0","255.255.255.0"],
    ["176.28.254.0","255.255.255.0"],
    ["176.28.255.0","255.255.255.0"],
    ["176.29.0.0","255.255.255.0"],
    ["176.29.1.0","255.255.255.0"],
    ["176.29.2.0","255.255.255.0"],
    ["176.29.3.0","255.255.255.0"],
    ["176.29.4.0","255.255.255.0"],
    ["176.29.5.0","255.255.255.0"],
    ["176.29.6.0","255.255.255.0"],
    ["176.29.7.0","255.255.255.0"],
    ["176.29.8.0","255.255.255.0"],
    ["176.29.9.0","255.255.255.0"],
    ["176.29.10.0","255.255.255.0"],
    ["176.29.11.0","255.255.255.0"],
    ["176.29.12.0","255.255.255.0"],
    ["176.29.13.0","255.255.255.0"],
    ["176.29.14.0","255.255.255.0"],
    ["176.29.15.0","255.255.255.0"],
    ["176.29.16.0","255.255.255.0"],
    ["176.29.17.0","255.255.255.0"],
    ["176.29.18.0","255.255.255.0"],
    ["176.29.19.0","255.255.255.0"],
    ["176.29.20.0","255.255.255.0"],
    ["176.29.21.0","255.255.255.0"],
    ["176.29.22.0","255.255.255.0"],
    ["176.29.23.0","255.255.255.0"],
    ["176.29.24.0","255.255.255.0"],
    ["176.29.25.0","255.255.255.0"],
    ["176.29.26.0","255.255.255.0"],
    ["176.29.27.0","255.255.255.0"],
    ["176.29.28.0","255.255.255.0"],
    ["176.29.29.0","255.255.255.0"],
    ["176.29.30.0","255.255.255.0"],
    ["176.29.31.0","255.255.255.0"],
    ["176.29.32.0","255.255.255.0"],
    ["176.29.33.0","255.255.255.0"],
    ["176.29.34.0","255.255.255.0"],
    ["176.29.35.0","255.255.255.0"],
    ["176.29.36.0","255.255.255.0"],
    ["176.29.37.0","255.255.255.0"],
    ["176.29.38.0","255.255.255.0"],
    ["176.29.39.0","255.255.255.0"],
    ["176.29.40.0","255.255.255.0"],
    ["176.29.41.0","255.255.255.0"],
    ["176.29.42.0","255.255.255.0"],
    ["176.29.43.0","255.255.255.0"],
    ["176.29.44.0","255.255.255.0"],
    ["176.29.45.0","255.255.255.0"],
    ["176.29.46.0","255.255.255.0"],
    ["176.29.47.0","255.255.255.0"],
    ["176.29.48.0","255.255.255.0"],
    ["176.29.49.0","255.255.255.0"],
    ["176.29.50.0","255.255.255.0"],
    ["176.29.51.0","255.255.255.0"],
    ["176.29.52.0","255.255.255.0"],
    ["176.29.53.0","255.255.255.0"],
    ["176.29.54.0","255.255.255.0"],
    ["176.29.55.0","255.255.255.0"],
    ["176.29.56.0","255.255.255.0"],
    ["176.29.57.0","255.255.255.0"],
    ["176.29.58.0","255.255.255.0"],
    ["176.29.59.0","255.255.255.0"],
    ["176.29.60.0","255.255.255.0"],
    ["176.29.61.0","255.255.255.0"],
    ["176.29.62.0","255.255.255.0"],
    ["176.29.63.0","255.255.255.0"],
    ["176.29.64.0","255.255.255.0"],
    ["176.29.65.0","255.255.255.0"],
    ["176.29.66.0","255.255.255.0"],
    ["176.29.67.0","255.255.255.0"],
    ["176.29.68.0","255.255.255.0"],
    ["176.29.69.0","255.255.255.0"],
    ["176.29.70.0","255.255.255.0"],
    ["176.29.71.0","255.255.255.0"],
    ["176.29.72.0","255.255.255.0"],
    ["176.29.73.0","255.255.255.0"],
    ["176.29.74.0","255.255.255.0"],
    ["176.29.75.0","255.255.255.0"],
    ["176.29.76.0","255.255.255.0"],
    ["176.29.77.0","255.255.255.0"],
    ["176.29.78.0","255.255.255.0"],
    ["176.29.79.0","255.255.255.0"],
    ["176.29.80.0","255.255.255.0"],
    ["176.29.81.0","255.255.255.0"],
    ["176.29.82.0","255.255.255.0"],
    ["176.29.83.0","255.255.255.0"],
    ["176.29.84.0","255.255.255.0"],
    ["176.29.85.0","255.255.255.0"],
    ["176.29.86.0","255.255.255.0"],
    ["176.29.87.0","255.255.255.0"],
    ["176.29.88.0","255.255.255.0"],
    ["176.29.89.0","255.255.255.0"],
    ["176.29.90.0","255.255.255.0"],
    ["176.29.91.0","255.255.255.0"],
    ["176.29.92.0","255.255.255.0"],
    ["176.29.93.0","255.255.255.0"],
    ["176.29.94.0","255.255.255.0"],
    ["176.29.95.0","255.255.255.0"],
    ["176.29.96.0","255.255.255.0"],
    ["176.29.97.0","255.255.255.0"],
    ["176.29.98.0","255.255.255.0"],
    ["176.29.99.0","255.255.255.0"],
    ["176.29.100.0","255.255.255.0"],
    ["176.29.101.0","255.255.255.0"],
    ["176.29.102.0","255.255.255.0"],
    ["176.29.103.0","255.255.255.0"],
    ["176.29.104.0","255.255.255.0"],
    ["176.29.105.0","255.255.255.0"],
    ["176.29.106.0","255.255.255.0"],
    ["176.29.107.0","255.255.255.0"],
    ["176.29.108.0","255.255.255.0"],
    ["176.29.109.0","255.255.255.0"],
    ["176.29.110.0","255.255.255.0"],
    ["176.29.111.0","255.255.255.0"],
    ["176.29.112.0","255.255.255.0"],
    ["176.29.113.0","255.255.255.0"],
    ["176.29.114.0","255.255.255.0"],
    ["176.29.115.0","255.255.255.0"],
    ["176.29.116.0","255.255.255.0"],
    ["176.29.117.0","255.255.255.0"],
    ["176.29.118.0","255.255.255.0"],
    ["176.29.119.0","255.255.255.0"],
    ["176.29.120.0","255.255.255.0"],
    ["176.29.121.0","255.255.255.0"],
    ["176.29.122.0","255.255.255.0"],
    ["176.29.123.0","255.255.255.0"],
    ["176.29.124.0","255.255.255.0"],
    ["176.29.125.0","255.255.255.0"],
    ["176.29.126.0","255.255.255.0"],
    ["176.29.127.0","255.255.255.0"],
    ["176.29.128.0","255.255.255.0"],
    ["176.29.129.0","255.255.255.0"],
    ["176.29.130.0","255.255.255.0"],
    ["176.29.131.0","255.255.255.0"],
    ["176.29.132.0","255.255.255.0"],
    ["176.29.133.0","255.255.255.0"],
    ["176.29.134.0","255.255.255.0"],
    ["176.29.135.0","255.255.255.0"],
    ["176.29.136.0","255.255.255.0"],
    ["176.29.137.0","255.255.255.0"],
    ["176.29.138.0","255.255.255.0"],
    ["176.29.139.0","255.255.255.0"],
    ["176.29.140.0","255.255.255.0"],
    ["176.29.141.0","255.255.255.0"],
    ["176.29.142.0","255.255.255.0"],
    ["176.29.143.0","255.255.255.0"],
    ["176.29.144.0","255.255.255.0"],
    ["176.29.145.0","255.255.255.0"],
    ["176.29.146.0","255.255.255.0"],
    ["176.29.147.0","255.255.255.0"],
    ["176.29.148.0","255.255.255.0"],
    ["176.29.149.0","255.255.255.0"],
    ["176.29.150.0","255.255.255.0"],
    ["176.29.151.0","255.255.255.0"],
    ["176.29.152.0","255.255.255.0"],
    ["176.29.153.0","255.255.255.0"],
    ["176.29.154.0","255.255.255.0"],
    ["176.29.155.0","255.255.255.0"],
    ["176.29.156.0","255.255.255.0"],
    ["176.29.157.0","255.255.255.0"],
    ["176.29.158.0","255.255.255.0"],
    ["176.29.159.0","255.255.255.0"],
    ["176.29.160.0","255.255.255.0"],
    ["176.29.161.0","255.255.255.0"],
    ["176.29.162.0","255.255.255.0"],
    ["176.29.163.0","255.255.255.0"],
    ["176.29.164.0","255.255.255.0"],
    ["176.29.165.0","255.255.255.0"],
    ["176.29.166.0","255.255.255.0"],
    ["176.29.167.0","255.255.255.0"],
    ["176.29.168.0","255.255.255.0"],
    ["176.29.169.0","255.255.255.0"],
    ["176.29.170.0","255.255.255.0"],
    ["176.29.171.0","255.255.255.0"],
    ["176.29.172.0","255.255.255.0"],
    ["176.29.173.0","255.255.255.0"],
    ["176.29.174.0","255.255.255.0"],
    ["176.29.175.0","255.255.255.0"],
    ["176.29.176.0","255.255.255.0"],
    ["176.29.177.0","255.255.255.0"],
    ["176.29.178.0","255.255.255.0"],
    ["176.29.179.0","255.255.255.0"],
    ["176.29.180.0","255.255.255.0"],
    ["176.29.181.0","255.255.255.0"],
    ["176.29.182.0","255.255.255.0"],
    ["176.29.183.0","255.255.255.0"],
    ["176.29.184.0","255.255.255.0"],
    ["176.29.185.0","255.255.255.0"],
    ["176.29.186.0","255.255.255.0"],
    ["176.29.187.0","255.255.255.0"],
    ["176.29.188.0","255.255.255.0"],
    ["176.29.189.0","255.255.255.0"],
    ["176.29.190.0","255.255.255.0"],
    ["176.29.191.0","255.255.255.0"],
    ["176.29.192.0","255.255.255.0"],
    ["176.29.193.0","255.255.255.0"],
    ["176.29.194.0","255.255.255.0"],
    ["176.29.195.0","255.255.255.0"],
    ["176.29.196.0","255.255.255.0"],
    ["176.29.197.0","255.255.255.0"],
    ["176.29.198.0","255.255.255.0"],
    ["176.29.199.0","255.255.255.0"],
    ["176.29.200.0","255.255.255.0"],
    ["176.29.201.0","255.255.255.0"],
    ["176.29.202.0","255.255.255.0"],
    ["176.29.203.0","255.255.255.0"],
    ["176.29.204.0","255.255.255.0"],
    ["176.29.205.0","255.255.255.0"],
    ["176.29.206.0","255.255.255.0"],
    ["176.29.207.0","255.255.255.0"],
    ["176.29.208.0","255.255.255.0"],
    ["176.29.209.0","255.255.255.0"],
    ["176.29.210.0","255.255.255.0"],
    ["176.29.211.0","255.255.255.0"],
    ["176.29.212.0","255.255.255.0"],
    ["176.29.213.0","255.255.255.0"],
    ["176.29.214.0","255.255.255.0"],
    ["176.29.215.0","255.255.255.0"],
    ["176.29.216.0","255.255.255.0"],
    ["176.29.217.0","255.255.255.0"],
    ["176.29.218.0","255.255.255.0"],
    ["176.29.219.0","255.255.255.0"],
    ["176.29.220.0","255.255.255.0"],
    ["176.29.221.0","255.255.255.0"],
    ["176.29.222.0","255.255.255.0"],
    ["176.29.223.0","255.255.255.0"],
    ["176.29.224.0","255.255.255.0"],
    ["176.29.225.0","255.255.255.0"],
    ["176.29.226.0","255.255.255.0"],
    ["176.29.227.0","255.255.255.0"],
    ["176.29.228.0","255.255.255.0"],
    ["176.29.229.0","255.255.255.0"],
    ["176.29.230.0","255.255.255.0"],
    ["176.29.231.0","255.255.255.0"],
    ["176.29.232.0","255.255.255.0"],
    ["176.29.233.0","255.255.255.0"],
    ["176.29.234.0","255.255.255.0"],
    ["176.29.235.0","255.255.255.0"],
    ["176.29.236.0","255.255.255.0"],
    ["176.29.237.0","255.255.255.0"],
    ["176.29.238.0","255.255.255.0"],
    ["176.29.239.0","255.255.255.0"],
    ["176.29.240.0","255.255.255.0"],
    ["176.29.241.0","255.255.255.0"],
    ["176.29.242.0","255.255.255.0"],
    ["176.29.243.0","255.255.255.0"],
    ["176.29.244.0","255.255.255.0"],
    ["176.29.245.0","255.255.255.0"],
    ["176.29.246.0","255.255.255.0"],
    ["176.29.247.0","255.255.255.0"],
    ["176.29.248.0","255.255.255.0"],
    ["176.29.249.0","255.255.255.0"],
    ["176.29.250.0","255.255.255.0"],
    ["176.29.251.0","255.255.255.0"],
    ["176.29.252.0","255.255.255.0"],
    ["176.29.253.0","255.255.255.0"],
    ["176.29.254.0","255.255.255.0"],
    ["176.29.255.0","255.255.255.0"],
    ["176.57.0.0","255.255.255.0"],
    ["176.57.1.0","255.255.255.0"],
    ["176.57.2.0","255.255.255.0"],
    ["176.57.3.0","255.255.255.0"],
    ["176.57.4.0","255.255.255.0"],
    ["176.57.5.0","255.255.255.0"],
    ["176.57.6.0","255.255.255.0"],
    ["176.57.7.0","255.255.255.0"],
    ["176.57.8.0","255.255.255.0"],
    ["176.57.9.0","255.255.255.0"],
    ["176.57.10.0","255.255.255.0"],
    ["176.57.11.0","255.255.255.0"],
    ["176.57.12.0","255.255.255.0"],
    ["176.57.13.0","255.255.255.0"],
    ["176.57.14.0","255.255.255.0"],
    ["176.57.15.0","255.255.255.0"],
    ["176.57.16.0","255.255.255.0"],
    ["176.57.17.0","255.255.255.0"],
    ["176.57.18.0","255.255.255.0"],
    ["176.57.19.0","255.255.255.0"],
    ["176.57.20.0","255.255.255.0"],
    ["176.57.21.0","255.255.255.0"],
    ["176.57.22.0","255.255.255.0"],
    ["176.57.23.0","255.255.255.0"],
    ["176.57.24.0","255.255.255.0"],
    ["176.57.25.0","255.255.255.0"],
    ["176.57.26.0","255.255.255.0"],
    ["176.57.27.0","255.255.255.0"],
    ["176.57.28.0","255.255.255.0"],
    ["176.57.29.0","255.255.255.0"],
    ["176.57.30.0","255.255.255.0"],
    ["176.57.31.0","255.255.255.0"],
  ];
  var LOBBY_DOMAINS = [
    "*.pubgmobile.com",
    "*.pubg.com",
    "*.tencentgames.com",
    "*.igamecj.com",
    "login.*",
    "lobby.*",
    "friend.*",
    "social.*",
    "matchmaking.*"
  ];
  var MATCH_DOMAINS = [
    "*.gcloud.qq.com",
    "*.qcloud.com",
    "*.garena.com",
    "*.umeng.com",
    "realtime.*",
    "battle.*",
    "game.*"
  ];
  var DNS_TTL_BASE_MS = 45000;
  var DNS_TTL_MIN_MS  = 8000;
  var DNS_TTL_MAX_MS  = 300000;
  var PROBE_MIN = 2;
  var PROBE_MAX = 4;
  var PROBE_RATE_LIMIT = 3000;
  var EWMA_ALPHA = 0.28;
  var VAR_ALPHA  = 0.18;
  var STICKY_PORT_TTL = 2700000;
  var SESSION_TTL     = 2700000;
  var SWITCH_FACTOR   = 1.6;
  var MEMORY_SEED_WEIGHT    = 0.65;
  var MEMORY_DECAY_HALFLIFE = 600000;
  if (typeof __JO_SMART === "undefined") {
    __JO_SMART = { dns:{}, stats:{}, sticky:{}, session:{}, memory:{} };
  }
  for (var i=0;i<PROXIES.length;i++){var p=PROXIES[i];if(!__JO_SMART.stats[p.ip])__JO_SMART.stats[p.ip]={ewma:null,variance:null,lastProbe:0};if(!__JO_SMART.memory[p.ip])__JO_SMART.memory[p.ip]={mean:null,variance:null,t:0};}
  function nowMs(){return(new Date()).getTime()}
  function isJordanIP(ip){if(!ip)return false;for(var i=0;i<JO_IP_SUBNETS.length;i++){if(isInNet(ip,JO_IP_SUBNETS[i][0],JO_IP_SUBNETS[i][1]))return true}return false}
  function isYouTube(h){var x=(h||"").toLowerCase();if(shExpMatch(x,"*.youtube.com"))return true;if(shExpMatch(x,"*.googlevideo.com"))return true;if(shExpMatch(x,"*.ytimg.com"))return true;if(x==="youtu.be"||shExpMatch(x,"youtu.be*"))return true;return false}
  function matchList(h,arr){for(var i=0;i<arr.length;i++) if(shExpMatch(h,arr[i])) return true;return false}
  function dnsCached(name){var e=__JO_SMART.dns[name];var t=nowMs();if(e&&(t-e.t)<(e.ttl||DNS_TTL_BASE_MS)) return e.ip;var ip=dnsResolve(name);__JO_SMART.dns[name]={ip:ip||null,t:t,ttl:DNS_TTL_BASE_MS};return ip||null}
  function adaptiveDNSttl(){var acc=0,n=0;for(var i=0;i<PROXIES.length;i++){var s=__JO_SMART.stats[PROXIES[i].ip];if(s&&s.ewma!==null&&s.variance!==null){acc+=(s.ewma+Math.sqrt(s.variance));n++}}if(!n) return DNS_TTL_BASE_MS;var q=Math.max(0.2,Math.min(5.0,acc/(n*50.0)));var ttl=Math.floor(DNS_TTL_BASE_MS/q);if(ttl<DNS_TTL_MIN_MS) ttl=DNS_TTL_MIN_MS;if(ttl>DNS_TTL_MAX_MS) ttl=DNS_TTL_MAX_MS;return ttl}
  function dynamicProbeCount(){var ttl=adaptiveDNSttl();if(ttl>=120000) return PROBE_MIN;if(ttl>=60000) return 3;return PROBE_MAX}
  function multiProbe(target,count){var ip=null,samples=[];for(var i=0;i<count;i++){var t0=nowMs();var r=dnsResolve(target);var t1=nowMs();if(!ip&&r) ip=r;samples.push(t1-t0)}var sum=0;for(var k=0;k<samples.length;k++) sum+=samples[k];var mean=sum/samples.length;var vs=0;for(var k=0;k<samples.length;k++) vs+=Math.pow(samples[k]-mean,2);var variance=vs/samples.length;return{ip:ip,mean:mean,variance:variance}}
  function blend(a,b,w){if(a===null)return b;if(b===null)return a;return(1-w)*a+w*b}
  function memoryWeight(t){var age=nowMs()-t;if(age<=0)return MEMORY_SEED_WEIGHT;var k=Math.pow(0.5,age/MEMORY_DECAY_HALFLIFE);return MEMORY_SEED_WEIGHT*k}
  function warmStart(ip){var st=__JO_SMART.stats[ip],mem=__JO_SMART.memory[ip];if(!st||!mem)return;if(st.ewma===null&&mem.mean!==null){var w=memoryWeight(mem.t);st.ewma=blend(st.ewma,mem.mean,w);st.variance=blend(st.variance,mem.variance,w)}}
  function coolDown(ip,mean,variance){var mem=__JO_SMART.memory[ip];if(!mem)return;var w=MEMORY_SEED_WEIGHT;mem.mean=blend(mem.mean,mean,w);mem.variance=blend(mem.variance,variance,w);mem.t=nowMs()}
  function updateStats(ip,mean,variance){var s=__JO_SMART.stats[ip];if(!s)return;if(s.ewma===null)s.ewma=mean;else s.ewma=(1-EWMA_ALPHA)*s.ewma+EWMA_ALPHA*mean;if(s.variance===null)s.variance=variance;else s.variance=(1-VAR_ALPHA)*s.variance+VAR_ALPHA*variance;s.lastProbe=nowMs();coolDown(ip,s.ewma,s.variance)}
  function maybeProbe(proxy,hostForProbe){warmStart(proxy.ip);var s=__JO_SMART.stats[proxy.ip],now=nowMs();if(s&&(now-s.lastProbe)<PROBE_RATE_LIMIT)return;var cnt=dynamicProbeCount();var target=proxy.ip||hostForProbe;var res=multiProbe(target,cnt);if(res.ip!==null) updateStats(proxy.ip,res.mean,res.variance)}
  function scoreProxy(proxy){warmStart(proxy.ip);var s=__JO_SMART.stats[proxy.ip];var mean=s&&s.ewma!==null?s.ewma:60;var variance=s&&s.variance!==null?s.variance:600;var vf=1+Math.sqrt(variance)/(1+mean);var score=proxy.weight/(1+mean)/vf;if(proxy.ports&&proxy.ports.indexOf(20001)!==-1) score*=1.12;return score}
  function jordanOnlyProxyList(){var out=[];for(var i=0;i<PROXIES.length;i++){if(isJordanIP(PROXIES[i].ip)) out.push(PROXIES[i])}return out.length?out:PROXIES}
  function chooseCandidate(hostname){var C=jordanOnlyProxyList();for(var i=0;i<C.length;i++) maybeProbe(C[i],hostname);var best=C[0],bestScore=-1e9;for(var i=0;i<C.length;i++){var sc=scoreProxy(C[i]);if(sc>bestScore){bestScore=sc;best=C[i]}}return best}
  function hashIndex(key,n){var h=0;for(var i=0;i<key.length;i++) h=((h<<5)-h)+key.charCodeAt(i);return Math.abs(h)%n}
  function stickyPort(hostname,proxy){var key=hostname+"@"+proxy.ip;var e=__JO_SMART.sticky[key];var t=nowMs();if(e&&(t-e.t)<STICKY_PORT_TTL) return e.port;var ports=proxy.ports&&proxy.ports.length?proxy.ports.slice():[443];ports.sort(function(a,b){if(a===20001) return -1;if(b===20001) return 1;return a-b});var idx=hashIndex(hostname,ports.length);var port=ports[idx];__JO_SMART.sticky[key]={port:port,t:t};return port}
  function pinSession(hostname,proxy){var s=__JO_SMART.session[hostname],t=nowMs();if(!s||!s.ip||(t-s.t)>SESSION_TTL){__JO_SMART.session[hostname]={ip:proxy.ip,t:t};return proxy}if(s.ip===proxy.ip){s.t=t;return proxy}var current=null;for(var i=0;i<PROXIES.length;i++) if(PROXIES[i].ip===s.ip) current=PROXIES[i];if(!current){__JO_SMART.session[hostname]={ip:proxy.ip,t:t};return proxy}var currScore=scoreProxy(current),candScore=scoreProxy(proxy);if(candScore>currScore*SWITCH_FACTOR){__JO_SMART.session[hostname]={ip:proxy.ip,t:t};return proxy}for(var i=0;i<PROXIES.length;i++) if(PROXIES[i].ip===s.ip) return PROXIES[i];__JO_SMART.session[hostname]={ip:proxy.ip,t:t};return proxy}
  function chainReturnProxy(hostname,proxy){var C=jordanOnlyProxyList();var p1=proxy,p2=null;for(var i=0;i<C.length;i++){if(C[i].ip!==p1.ip){p2=C[i];break}}var port1=stickyPort(hostname,p1);if(!p2) return "PROXY "+p1.ip+":"+port1;var port2=stickyPort(hostname,p2);return "PROXY "+p1.ip+":"+port1+"; PROXY "+p2.ip+":"+port2}
  function chainReturnSocks(hostname,proxy){var C=jordanOnlyProxyList();var p1=proxy,p2=null;for(var i=0;i<C.length;i++){if(C[i].ip!==p1.ip){p2=C[i];break}}var port1=stickyPort(hostname,p1);if(!p2) return "SOCKS5 "+p1.ip+":"+port1;var port2=stickyPort(hostname,p2);return "SOCKS5 "+p1.ip+":"+port1+"; SOCKS5 "+p2.ip+":"+port2}
  var h=(host||"").toLowerCase();
  if(isYouTube(h)) return "DIRECT";
  var hostIP=dnsCached(h); var e=__JO_SMART.dns[h]; if(e) e.ttl=adaptiveDNSttl();
  var isJO=hostIP&&isJordanIP(hostIP);
  var isLobby=matchList(h,LOBBY_DOMAINS);
  var isMatch=matchList(h,MATCH_DOMAINS)||h.indexOf("pubg")!==-1||h.indexOf("tencent")!==-1;
  if(isJO && !FORBID_DIRECT_GLOBAL && !isLobby && !isMatch) return "DIRECT";
  var candidate=chooseCandidate(h);
  var chosen=pinSession(h,candidate);
  if(isMatch) return chainReturnSocks(h,chosen);
  if(isLobby) return chainReturnProxy(h,chosen);
  if(FORBID_DIRECT_GLOBAL) return chainReturnProxy(h,chosen);
  if(isJO) return "DIRECT";
  return chainReturnProxy(h,chosen);
}